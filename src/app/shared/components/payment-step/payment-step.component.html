<div class="step-content">
    <h2>Payment Method</h2>

    <app-booking-summary
            [date]="date"
            [time]="time"
            [rooms]="rooms"
            [roomSummaries]="roomSummaries"
            [totalPlayers]="totalPlayers"
            [net]="net"
            [vat]="vat"
            [total]="total"
            [taxPercent]="taxPercent"
            [currency]="currency"

            [baseTotal]="baseTotal"
            [promoTotal]="promoTotal"
            [promoPercent]="promoPercent"
            [promoName]="promoName"

            [giftCardAmount]="store.giftCardAmount()"
            [giftCardCode]="store.giftCardCode()"
            (onRemovePromo)="removeGiftCardCode()"
    ></app-booking-summary>

    <!-- ðŸ’³ Gift card BEFORE contact details -->
    <div class="form-section">
        <h3>Gift Card</h3>
        <div class="gift-grid">
            <label>
                Gift card code
                <input
                        type="text"
                        placeholder="Enter gift card code"
                        [(ngModel)]="giftCode"
                        [disabled]="giftLoading || submitting"
                />
            </label>

            <div class="gift-actions">
                <app-button
                        (clicked)="applyGiftCard()"
                        [disabled]="giftLoading || submitting || !giftCode.trim()"
                >
                    {{ giftLoading ? 'Checking...' : 'Apply' }}
                </app-button>

                <div class="gift-status" *ngIf="giftError">
                    {{ giftError }}
                </div>
                <div
                        class="gift-status success"
                        *ngIf="!giftError && store.giftCardAmount() > 0"
                >
                    Gift card applied:
                    -{{ store.giftCardAmount() | number: '1.0-0' }} {{ currency }}
                </div>
            </div>
        </div>
    </div>

    <!-- ðŸ§â€â™€ï¸ Contact details (unchanged) -->
    <app-contact-details
            [customer]="store.customerInfo()"
            (customerChange)="store.setCustomerInfo($event)"
    ></app-contact-details>

    <!-- ðŸ’³ Payment method -->
    <div class="form-section">
        <h3>Choose Payment Method</h3>
        <app-payment-method-selector
                [paymentMethod]="paymentMethod"
                (paymentMethodChange)="paymentMethodChange.emit($event)"
        ></app-payment-method-selector>
    </div>

    <div class="step-actions">
        <app-button variant="outline" (clicked)="back.emit()">Back</app-button>
        <app-button
                (clicked)="submit.emit()"
                [disabled]="!paymentMethod || !isCustomerValid"
                [loading]="submitting"
        >
            {{ paymentMethod === 'ONLINE' ? 'Proceed to Payment' : 'Complete Booking' }}
        </app-button>
    </div>
</div>
