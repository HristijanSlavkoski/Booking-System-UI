<!DOCTYPE html>
<html lang="en">
<head>
    <title>VR Escape - Virtual Reality Escape Rooms</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description"
          content="Experience the ultimate VR escape room adventure. Book your immersive virtual reality experience today!"/>
    <base href="/">
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <script>
        (function () {
            // Derive the parent origin from document.referrer (works cross-origin)
            const ref = document.referrer || '';
            let PARENT_ORIGIN = '*';
            try {
                PARENT_ORIGIN = new URL(ref).origin;
            } catch (_) {
            }

            let lastHeight = 0;
            let rafId = null;
            let ro = null;

            function getHeight() {
                const b = document.body, d = document.documentElement;
                return Math.max(
                    b.scrollHeight, d.scrollHeight,
                    b.offsetHeight, d.offsetHeight,
                    b.clientHeight, d.clientHeight
                );
            }

            function post(msg) {
                // If you want strict security, replace '*' with PARENT_ORIGIN
                window.parent.postMessage(msg, PARENT_ORIGIN || '*');
            }

            function schedulePostHeight(shrinkAware = true) {
                if (rafId) cancelAnimationFrame(rafId);
                rafId = requestAnimationFrame(() => {
                    const h = getHeight();
                    const shrank = shrinkAware && lastHeight && h < lastHeight - 80;
                    lastHeight = h;
                    post({type: 'booking-system:heightAndMaybeScroll', height: h, shrank});
                });
            }

            function safeObserve(el) {
                if (!el || el.nodeType !== 1) return;
                try {
                    ro.observe(el);
                } catch (_) {
                }
            }

            window.addEventListener('load', () => {
                schedulePostHeight(false);

                ro = new ResizeObserver(() => schedulePostHeight(true));

                const contentRoot =
                    document.getElementById('app') ||
                    document.getElementById('root') ||
                    document.body;

                safeObserve(contentRoot);
                safeObserve(document.documentElement);

                // Fallback for async layout shifts (fonts/images/route changes)
                setInterval(() => schedulePostHeight(true), 800);
            });

            // Call this from your app after major UI changes if needed
            window.requestParentScrollToTop = function () {
                post({type: 'booking-system:scrollToTop'});
            };
        })();
    </script>

</head>
<body>
<app-root>Loading...</app-root>
</body>
</html>
