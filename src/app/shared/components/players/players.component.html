<div class="players-page">
    <div class="players-container">
        <h1 class="title">
            {{ 'players.title' | translate : {default: 'Choose Players'} }}
        </h1>

        @if (loading()) {
            <div class="loading">{{ 'common.loading' | translate }}</div>
        } @else {
            @if (game()) {
                <div class="info-card">
                    <div class="info-left">
                        <img *ngIf="game()?.imageUrl" [src]="game()?.imageUrl!" class="thumb" alt=""/>
                        <div class="meta">
                            <div class="game-name">{{ game()?.name }}</div>
                            <div class="game-sub">
                                <span>{{ game()?.duration }} {{ 'calendar.minutes' | translate }}</span>
                                <span> Â· {{ minPlayers() }}
                                    â€“{{ maxPlayers() }} {{ 'calendar.players' | translate }}</span>
                            </div>
                            <div class="datetime">
                                <span>ðŸ“… {{ date() }}</span>
                                <span>ðŸ•’ {{ time() }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="info-right">
                        <div class="picker-title">
                            {{ 'players.howMany' | translate : {default: 'How many players?'} }}
                        </div>

                        <!-- SIMPLIFIED CHIPS: only the number -->
                        <div class="player-grid">
                            @for (n of options(); track n) {
                                <button
                                        class="player-chip simple"
                                        [class.selected]="players() === n"
                                        (click)="selectPlayers(n)">
                                    {{ n }}
                                </button>
                            }
                        </div>

                        <!-- per-person price (VAT included) once a choice is made -->
                        @if (players()) {
                            <div class="per-person-line">
                                <span class="label">
                                  {{ 'players.pricePerPerson' | translate:{default: 'Price per person'} }}
                                    ({{ 'players.vatIncluded' | translate:{default: 'incl. VAT'} }})
                                </span>
                                <span class="value">{{ pricePerPersonInclVat() }} MKD</span>
                            </div>
                        }

                        <!-- tax note stays as-is -->
                        <div class="tax-note">
                            {{ 'players.taxNoteIncluded' | translate:{percent: (taxPercentage() || 0)} }}
                        </div>

                        @if (players()) {
                            <app-price-summary
                                    [net]="selectedNetPortion()"
                                    [vat]="selectedVatPortion()"
                                    [total]="selectedTotalInclVat()"
                                    [taxPercent]="taxPercentage()"
                                    currency="MKD"
                                    [compact]="false"
                            />
                        }

                        <div class="actions">
                            <app-button variant="outline" (clicked)="backToCalendar()">
                                {{ 'common.back' | translate : {default: 'Back'} }}
                            </app-button>
                            <app-button (clicked)="continueToBooking()" [disabled]="!players()">
                                {{ 'players.continue' | translate : {default: 'Continue'} }}
                            </app-button>
                        </div>
                    </div>
                </div>
            } @else {
                <div class="error">
                    {{ 'players.noGame' | translate : {default: 'Game not found.'} }}
                </div>
            }
        }
    </div>
</div>
