<!DOCTYPE html>
<html lang="en">
<head>
    <title>VR Escape - Virtual Reality Escape Rooms</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description"
          content="Experience the ultimate VR escape room adventure. Book your immersive virtual reality experience today!"/>
    <base href="/">
    <script>
        (function () {
            const PARENT_ORIGIN = '*'; // tighten to 'https://intetic.com' in prod
            let lastSent = 0;
            let lastInnerH = window.innerHeight;

            // OPTIONAL: tame 100vh loops — override “stretch to viewport” on root containers
            const antiVhCSS = `
    html, body { height:auto !important; min-height:0 !important; }
    #app-root, #app, #root { min-height:auto !important; height:auto !important; }
  `;
            const style = document.createElement('style');
            style.textContent = antiVhCSS;
            document.head.appendChild(style);

            function contentRoot() {
                return document.getElementById('app-root')
                    || document.getElementById('app')
                    || document.getElementById('root')
                    || document.body;
            }

            // Measure intrinsic content height of the root (avoid viewport/clientHeight)
            function measure(root) {
                if (!root) return 0;
                const h1 = root.scrollHeight || 0;
                const h2 = root.offsetHeight || 0;
                return Math.max(h1, h2);
            }

            function postHeight(forceScrollCheck = true) {
                const root = contentRoot();
                const h = measure(root);
                const innerH = window.innerHeight;

                // Ignore tiny noise
                const delta = Math.abs(h - lastSent);

                // If the only thing that changed is the viewport (parent grew iframe),
                // ignore small upward bumps to prevent runaway growth.
                const viewportGrew = innerH > lastInnerH;
                const looksLikeFeedback = viewportGrew && (h > lastSent) && delta < 24;

                if (!looksLikeFeedback && delta >= 8) {
                    const shrank = forceScrollCheck && lastSent && h < lastSent - 60; // content got much shorter
                    lastSent = h;
                    lastInnerH = innerH;
                    window.parent.postMessage(
                        {type: 'booking-system:height', height: h, shrank},
                        PARENT_ORIGIN
                    );
                } else {
                    // still remember viewport changes to improve detection
                    lastInnerH = innerH;
                }
            }

            let rafId = null;
            const schedule = () => {
                if (rafId) cancelAnimationFrame(rafId);
                rafId = requestAnimationFrame(() => postHeight(true));
            };

            function start() {
                postHeight(false);

                // Prefer ResizeObserver on root only (not <html>)
                try {
                    const ro = new ResizeObserver(schedule);
                    ro.observe(contentRoot());
                } catch (_) {
                    try {
                        const mo = new MutationObserver(schedule);
                        mo.observe(contentRoot(), {
                            childList: true,
                            subtree: true,
                            attributes: true,
                            characterData: true
                        });
                    } catch (_) {
                    }
                }

                // Fallback: periodic check for late assets/fonts/layout
                setInterval(schedule, 800);
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', start);
            } else {
                start();
            }
        })();
    </script>

</head>
<body>
<app-root>Loading...</app-root>
</body>
</html>
