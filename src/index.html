<!DOCTYPE html>
<html lang="en">
<head>
    <title>VR Escape - Virtual Reality Escape Rooms</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description"
          content="Experience the ultimate VR escape room adventure. Book your immersive virtual reality experience today!"/>
    <base href="/">
    <script>
        (function () {
            const PARENT_ORIGIN = '*'; // set to 'https://intetic.com' in production
            let lastSent = 0;
            let ro = null;
            let rafId = null;

            // Pick a stable content root that reflects intrinsic content height,
            // not the viewport.
            function getContentRoot() {
                const byId = document.getElementById('app-root') || document.getElementById('app') || document.getElementById('root');
                if (byId) return byId;

                // Fallback: choose the tallest direct child of body
                let tallest = null, maxH = 0;
                const kids = document.body ? Array.from(document.body.children) : [];
                for (const el of kids) {
                    const h = Math.max(el.scrollHeight, el.offsetHeight);
                    if (h > maxH) { maxH = h; tallest = el; }
                }
                // As last resort, use body (but avoid html/documentElement)
                return tallest || document.body;
            }

            function measureHeight(root) {
                if (!root) return 0;
                // Use scrollHeight/offsetHeight of the ROOT ONLY (avoid html/body clientHeight).
                return Math.max(root.scrollHeight, root.offsetHeight);
            }

            function postHeight(root) {
                const h = measureHeight(root);
                if (!h) return;

                // Hysteresis: only send if |Î”| >= 8px to avoid tiny oscillations
                if (Math.abs(h - lastSent) < 8) return;

                // If content shrank substantially, flag it so parent can scroll to top of iframe.
                const shrank = lastSent && h < lastSent - 40;
                lastSent = h;

                window.parent.postMessage({ type: 'booking-system:height', height: h, shrank }, PARENT_ORIGIN);
            }

            function schedulePost(root) {
                if (rafId) cancelAnimationFrame(rafId);
                rafId = requestAnimationFrame(() => postHeight(root));
            }

            function start() {
                const root = getContentRoot();
                // Initial send
                schedulePost(root);

                // Observe intrinsic content changes on the root only (not <html>).
                try {
                    ro = new ResizeObserver(() => schedulePost(root));
                    ro.observe(root);
                } catch (e) {
                    // Fallback: MutationObserver
                    try {
                        const mo = new MutationObserver(() => schedulePost(root));
                        mo.observe(root, { childList: true, subtree: true, attributes: true, characterData: true });
                    } catch (_) {}
                }

                // Safety ping for async layout shifts (fonts/images)
                setInterval(() => schedulePost(root), 700);
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', start);
            } else {
                start();
            }
        })();
    </script>


</head>
<body>
<app-root>Loading...</app-root>
</body>
</html>
